<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.shop.mapper.AdminMapper">

	<!-- 카테고리 호출 -->
	<select id="category" resultType="com.shop.domain.CategoryVO">
		select
		level, cateName,
		cateCode, cateCodeRef
		from tbl_category
		start with cateCodeRef is null
		connect by prior cateCode = cateCodeRef
	</select>

	<insert id="register">
		insert into tbl_goods (gdsNum, gdsName, cateCode,
		gdsPrice, gdsStock,
		gdsDes , gdsImg , gdsThumbImg)
		values
		(tbl_goods_seq.nextval, #{gdsName},
		#{cateCode}, #{gdsPrice},
		#{gdsStock}, #{gdsDes} , #{gdsImg} , #{gdsThumbImg} )
	</insert>

	<select id="goodslist" resultType="com.shop.domain.GoodsViewVO">
		select
		g.gdsNum, g.gdsName,
		g.cateCode, c.cateCodeRef, c.cateName,
		gdsPrice, gdsStock,
		gdsDes,
		gdsImg, gdsDate, gdsImgs, g.gdsImg, g.gdsThumbImg
		from
		tbl_goods g
		inner
		join
		tbl_category c
		on g.cateCode = c.cateCode

	</select>


	<select id="goodsView" resultType="com.shop.domain.GoodsViewVO">
		select
		g.gdsNum, g.gdsName,
		g.cateCode, c.cateCode, c.cateCodeRef, c.cateName,
		gdsPrice, gdsStock,
		gdsDes,
		gdsImg, gdsDate, g.gdsImg, g.gdsThumbImg
		from
		tbl_goods g
		inner
		join tbl_category c
		on g.cateCode = c.cateCode
		where
		g.gdsNum =
		#{gdsNum}

	</select>

	<update id="goodsModify">
		update tbl_goods
		set
		gdsName = #{gdsName},
		cateCode =
		#{cateCode},
		gdsPrice = #{gdsPrice},
		gdsStock = #{gdsStock},
		gdsDes =
		#{gdsDes},
		gdsImg = #{gdsImg},
		gdsThumbImg = #{gdsThumbImg}
		where gdsNum
		= #{gdsNum}
	</update>




	<delete id="goodsDelete">
		delete
		from tbl_goods
		where gdsNum = #{gdsNum}


	</delete>

	<!-- 모든 유저의 주문 목록 -->
	<select id="orderList" resultType="com.shop.domain.OrderVO">
		select
		orderId, userId,
		orderRec,
		userAddr1, userAddr2, userAddr3,
		orderPhon, amount, orderDate,
		delivery
		from tbl_order
	</select>

	<!-- 특정 주문 목록 -->
	<select id="orderView" resultType="com.shop.domain.OrderListVO">
		select
		o.orderId, o.userId,
		o.orderRec,
		o.userAddr1, o.userAddr2, o.userAddr3,
		o.orderPhon,
		o.amount, o.orderDate, o.delivery, o.gdsNames,
		d.orderDetailsNum,
		d.gdsNum,
		d.cartStock,
		g.gdsName, g.gdsThumbImg, g.gdsPrice
		from
		tbl_order o
		inner
		join tbl_order_details d
		on o.orderId = d.orderId
		inner
		join tbl_goods g
		on d.gdsNum = g.gdsNum
		where o.orderId =
		#{orderId}
	</select>

	<update id="delivery">
		update tbl_order
		set delivery = #{delivery}
		where
		orderId = #{orderId}

	</update>

	<update id="changeStock">
		update tbl_goods
		set gdsStock = gdsStock -
		#{gdsStock}
		where gdsNum = #{gdsNum}

	</update>



	<select id="changeStock_sub"
		resultType="com.shop.domain.OrderDetailVO">
		select
		orderId, gdsNum, cartStock
		from tbl_order_details
		where orderId = #{orderId}

	</select>


	<select id="getMemberList" resultType="com.shop.domain.MemberVO">
		select * from tbl_member

	</select>


	<update id="memberUpdate">
		update tbl_member set
		userid=#{userid},
		username=#{userName},

		useremail=#{useremail},
		useraddress=#{useraddress},
		userphoneNumber=#{userphoneNumber}
		where
		userid=#{userid}

	</update>


	<select id="getMember" resultType="com.shop.domain.MemberVO">
		select * from tbl_member where
		userid=#{userid}

	</select>

	<delete id="deleteMember">
		delete from tbl_member where userid=#{userid}

	</delete>

	<select id="read" resultType="com.shop.domain.MemberVO">
		select * from tbl_member where
		userid=#{userid}
	</select>

</mapper>